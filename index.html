<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2563EB">
    <title>RM Volley</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="RM Volley">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="media/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="media/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="media/icon-152x152.png">
    <link rel="apple-touch-icon" href="media/icon-192x192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="media/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/icon-72x72.png">

    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="privacy-footer.css">
</head>

<body>
    <!-- Pull to refresh indicator -->
    <div class="pull-indicator" id="pullIndicator">
        <span class="pull-indicator-icon">&#8595;</span>
        <span>Rilascia per aggiornare</span>
    </div>

    <!-- App layout: sidebar + main -->
    <div class="app-layout">

        <!-- SIDEBAR (desktop only) -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <img src="media/rmlogo.png" alt="RM Volley" class="sidebar-logo" onerror="this.style.display='none'">
                <span class="sidebar-title">RM Volley</span>
            </div>

            <nav class="sidebar-nav" aria-label="Navigazione principale">
                <button class="sidebar-nav-item active" data-tab="home" aria-selected="true">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span>Home</span>
                </button>
                <button class="sidebar-nav-item" data-tab="partite" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <span>Partite</span>
                </button>
                <button class="sidebar-nav-item" data-tab="squadre" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                    <span>Squadre</span>
                </button>
                <button class="sidebar-nav-item" data-tab="classifiche" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                    <span>Classifiche</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <a href="rag-chat.html" target="_blank" class="sidebar-nav-item sidebar-link">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                    <span>AI Assistant</span>
                </a>
                <button id="scoutTabBtn" class="sidebar-nav-item" data-tab="scout" style="display:none">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
                    <span>Scouting</span>
                </button>
                <button id="socialTabBtn" class="sidebar-nav-item" data-tab="social" style="display:none">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                    <span>Social Media</span>
                </button>
                <button id="loginTabBtn" class="sidebar-nav-item" data-tab="login">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    <span>Login</span>
                </button>
                <button id="logoutTabBtn" class="sidebar-nav-item" data-tab="logout" style="display:none">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">

            <!-- Mobile topbar -->
            <div class="topbar">
                <span class="topbar-title" id="topbarTitle">Home</span>
                <div class="topbar-actions">
                    <a href="rag-chat.html" target="_blank" class="topbar-icon-btn" title="AI Assistant">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                    </a>
                    <button id="loginTabBtnMobile" class="topbar-icon-btn" data-tab="login" title="Login">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    </button>
                    <button id="logoutTabBtnMobile" class="topbar-icon-btn" data-tab="logout" style="display:none" title="Logout">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    </button>
                </div>
            </div>

            <!-- Hidden stubs for mobile scout/social (auth-tabs.js compatibility) -->
            <button id="scoutTabBtnMobile" data-tab="scout" style="display:none" aria-hidden="true"></button>
            <button id="socialTabBtnMobile" data-tab="social" style="display:none" aria-hidden="true"></button>

            <div class="content-area">

                <!-- Loading State -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Caricamento dati...</p>
                </div>

                <!-- HOME TAB -->
                <div id="home-tab" class="tab-content active" style="display:none">

                    <section class="content-section" id="todaysMatchesSection" style="display:none">
                        <h2 class="section-title">Oggi</h2>
                        <div id="todaysMatchesList"></div>
                    </section>

                    <section class="content-section" id="nextMatchSection" style="display:none">
                        <h2 class="section-title">Prossima partita</h2>
                        <div id="nextMatchCard"></div>
                    </section>

                    <section class="content-section">
                        <h2 class="section-title">Ultimi risultati</h2>
                        <div class="card" id="recentMatchesList"></div>
                    </section>

                </div>

                <!-- PARTITE TAB -->
                <div id="partite-tab" class="tab-content">

                    <div class="filters card">
                        <div class="filter-grid">
                            <div class="filter-group">
                                <label class="filter-label" for="filterTeam">Squadra</label>
                                <select id="filterTeam" class="filter-select">
                                    <option value="">Tutte le squadre</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label" for="filterStatus">Stato</label>
                                <select id="filterStatus" class="filter-select">
                                    <option value="">Tutti gli stati</option>
                                    <option value="gara omologata">Completate</option>
                                    <option value="risultato ufficioso">Non ufficiali</option>
                                    <option value="da disputare" selected>Da disputare</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label" for="searchInput">Cerca</label>
                                <input type="text" id="searchInput" class="filter-input" placeholder="Squadra, impianto...">
                            </div>
                        </div>
                    </div>

                    <p class="matches-count" id="matchesSubtitle"></p>
                    <div id="matchesList"></div>

                </div>

                <!-- SQUADRE TAB -->
                <div id="squadre-tab" class="tab-content">
                    <div class="teams-grid" id="teamsGrid"></div>

                    <div class="charts-section">
                        <h2 class="section-title">Statistiche</h2>
                        <div class="charts-grid">
                            <div class="chart-card card">
                                <h3 class="chart-title">Vittorie e Sconfitte</h3>
                                <div class="chart-container">
                                    <canvas id="winsChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card card">
                                <h3 class="chart-title">Set Vinti vs Persi</h3>
                                <div class="chart-container">
                                    <canvas id="setsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CLASSIFICHE TAB -->
                <div id="classifiche-tab" class="tab-content">
                    <div class="standings-header">
                        <h2 class="section-title">Classifica</h2>
                        <div class="standings-controls">
                            <select id="leagueSelect" class="filter-select"></select>
                            <span class="last-update" id="standingsLastUpdate"></span>
                        </div>
                    </div>

                    <div class="card standings-card">
                        <div class="table-responsive">
                            <table class="standings-table" id="standingsTable">
                                <thead>
                                    <tr>
                                        <th class="text-center">#</th>
                                        <th>Squadra</th>
                                        <th class="text-center">Pt</th>
                                        <th class="text-center">G</th>
                                        <th class="text-center">V</th>
                                        <th class="text-center">P</th>
                                        <th class="text-center col-hide">SF</th>
                                        <th class="text-center col-hide">SS</th>
                                    </tr>
                                </thead>
                                <tbody id="standingsBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div><!-- /content-area -->
        </main>
    </div><!-- /app-layout -->

    <!-- Privacy Footer -->
    <footer class="privacy-footer">
        <p><strong>Privacy:</strong> Utilizziamo solo i dati necessari per il funzionamento (localStorage e Firebase per chat live).</p>
        <p>Non utilizziamo cookie di tracciamento. <a href="privacy.html">Leggi la Privacy Policy completa</a>.</p>
    </footer>

    <!-- Mobile Bottom Nav -->
    <nav class="bottom-nav" role="navigation" aria-label="Navigazione mobile">
        <button class="bottom-nav-item active" data-tab="home" aria-selected="true">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span>Home</span>
        </button>
        <button class="bottom-nav-item" data-tab="partite" aria-selected="false">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            <span>Partite</span>
        </button>
        <button class="bottom-nav-item" data-tab="squadre" aria-selected="false">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
            <span>Squadre</span>
        </button>
        <button class="bottom-nav-item" data-tab="classifiche" aria-selected="false">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
            <span>Classifiche</span>
        </button>
    </nav>

    <!-- Team Detail Modal -->
    <div id="teamModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTeamName">
        <div class="modal-backdrop" onclick="closeTeamModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTeamName" class="modal-title">Dettagli Squadra</h2>
                <button class="modal-close" onclick="closeTeamModal()" aria-label="Chiudi">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script type="module" src="utils.js"></script>
    <script type="module" src="app.js"></script>

    <!-- Nav redirect handlers -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            ['scoutTabBtn','scoutTabBtnMobile'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('click', () => window.location.href = 'scout.html');
            });
            ['socialTabBtn','socialTabBtnMobile'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('click', () => window.location.href = 'social.html');
            });
        });
    </script>

    <!-- Login/Logout handlers -->
    <script type="module">
        import { signOut } from './auth-simple.js';
        document.addEventListener('DOMContentLoaded', () => {
            const handleLogin = () => window.location.href = 'login.html';
            const handleLogout = () => { signOut(); window.location.reload(); };
            ['loginTabBtn','loginTabBtnMobile'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('click', handleLogin);
            });
            ['logoutTabBtn','logoutTabBtnMobile'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('click', handleLogout);
            });
        });
    </script>

    <!-- Auth tab visibility -->
    <script type="module" src="auth-tabs.js"></script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
