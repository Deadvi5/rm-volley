<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0066FF">
    <title>RM Volley - Dashboard Pro</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RM Volley">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="media/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="media/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="media/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="114x114" href="media/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="76x76" href="media/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="72x72" href="media/icon-72x72.png">
    <link rel="apple-touch-icon" href="media/icon-192x192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="media/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/icon-72x72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/icon-72x72.png">

    <!-- Preconnect to CDNs for better performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- SheetJS library for reading Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Chart.js for data visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Pull to refresh indicator -->
    <div class="pull-indicator" id="pullIndicator">
        <div class="pull-indicator-icon">‚Üì</div>
        <span>Rilascia per aggiornare</span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <img src="media/rmlogo.png" alt="RM Volley Logo">
                </div>
                <div class="logo-text">
                    <h1>RM Volley</h1>
                    <p>Dashboard Pro</p>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalTeams">0</div>
                    <div class="stat-label">Squadre</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalMatches">0</div>
                    <div class="stat-label">Partite</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalWins">0</div>
                    <div class="stat-label">Vittorie</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs" role="navigation">
        <button class="nav-tab active" data-tab="overview" aria-selected="true">
            <span class="nav-tab-icon">üìä</span>
            <span class="nav-tab-text">Panoramica</span>
        </button>
        <button class="nav-tab" data-tab="teams" aria-selected="false">
            <span class="nav-tab-icon">üë•</span>
            <span class="nav-tab-text">Squadre</span>
        </button>
        <button class="nav-tab" data-tab="matches" aria-selected="false">
            <span class="nav-tab-icon">üèê</span>
            <span class="nav-tab-text">Partite</span>
        </button>
        <button class="nav-tab" data-tab="stats" aria-selected="false">
            <span class="nav-tab-icon">üìà</span>
            <span class="nav-tab-text">Statistiche</span>
        </button>
        <button class="nav-tab" data-tab="insights" aria-selected="false">
            <span class="nav-tab-icon">üí°</span>
            <span class="nav-tab-text">Insights</span>
        </button>
    </nav>

    <!-- Main Container -->
    <main class="container">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Caricamento dati...</p>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active" style="display: none;">
            <!-- Quick Stats -->
            <section class="quick-stats" id="quickStats" aria-label="Statistiche rapide"></section>

            <!-- Insights -->
            <section class="insights-grid" id="insightsGrid" aria-label="Insights principali"></section>

            <!-- Leaderboard -->
            <section class="leaderboard" aria-label="Classifica squadre">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üèÜ</span>
                        Classifica per Win Rate
                    </h2>
                </div>
                <div id="leaderboardList"></div>
            </section>

            <!-- Recent Matches -->
            <section aria-label="Partite recenti">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">
                            <span class="section-icon">‚ö°</span>
                            Ultime Partite
                        </h2>
                        <p class="section-subtitle">Risultati recenti</p>
                    </div>
                </div>
                <div class="matches-list" id="recentMatchesList"></div>
            </section>
        </div>

        <!-- Teams Tab -->
        <div id="teams-tab" class="tab-content">
            <div class="teams-grid" id="teamsGrid"></div>
        </div>

        <!-- Matches Tab -->
        <div id="matches-tab" class="tab-content">
            <div class="filters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label" for="filterTeam">Squadra</label>
                        <select id="filterTeam" class="filter-select">
                            <option value="">Tutte le squadre</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" for="filterStatus">Stato</label>
                        <select id="filterStatus" class="filter-select">
                            <option value="">Tutti gli stati</option>
                            <option value="gara omologata">Completate</option>
                            <option value="risultato ufficioso">Non ufficiali</option>
                            <option value="da disputare">Da disputare</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" for="searchInput">Cerca</label>
                        <input type="text" id="searchInput" class="filter-input"
                            placeholder="Cerca squadra, impianto...">
                    </div>
                </div>
            </div>

            <div class="section-header">
                <div>
                    <h2 class="section-title">
                        <span class="section-icon">üìÖ</span>
                        Calendario
                    </h2>
                    <p class="section-subtitle" id="matchesSubtitle">Tutte le partite</p>
                </div>
            </div>
            <div class="matches-list" id="matchesList"></div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Vittorie per Squadra</h3>
                    <div class="chart-container">
                        <canvas id="winsChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Win Rate Percentuale</h3>
                    <div class="chart-container">
                        <canvas id="winRateChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Partite per Campionato</h3>
                    <div class="chart-container">
                        <canvas id="championshipChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Set Vinti vs Persi</h3>
                    <div class="chart-container">
                        <canvas id="setsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Insights Tab -->
        <div id="insights-tab" class="tab-content">
            <div id="detailedInsights"></div>
        </div>
    </main>

    <!-- Team Detail Modal -->
    <div id="teamModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTeamName">
        <div class="modal-backdrop" onclick="closeTeamModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTeamName" class="modal-title">Team Details</h2>
                <button class="modal-close" onclick="closeTeamModal()" aria-label="Chiudi">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>