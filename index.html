<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0066FF">
    <title>RM Volley - Dashboard Pro</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RM Volley">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="media/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="media/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="media/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="114x114" href="media/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="76x76" href="media/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="72x72" href="media/icon-72x72.png">
    <link rel="apple-touch-icon" href="media/icon-192x192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="media/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/icon-72x72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/icon-72x72.png">

    <!-- Preconnect to CDNs for better performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- SheetJS library for reading Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Chart.js for data visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Pull to refresh indicator -->
    <div class="pull-indicator" id="pullIndicator">
        <div class="pull-indicator-icon">‚Üì</div>
        <span>Rilascia per aggiornare</span>
    </div>

    <!-- Mobile Header -->
    <header class="header mobile-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="media/rmlogo.png" alt="RM Volley" class="header-logo" onerror="this.style.display='none'">
                <h1 class="app-title"></h1>
            </div>
            <div class="mobile-actions">
            </div>
        </div>
    </header>
    <!-- Desktop Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <img src="media/rmlogo.png" alt="RM Volley Logo">
                </div>
                <div class="logo-text">
                    <h1>RM Volley</h1>
                    <p>Dashboard Pro</p>
                </div>
            </div>

            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalTeams">0</div>
                    <div class="stat-label">Squadre</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalMatches">0</div>
                    <div class="stat-label">Partite</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalWins">0</div>
                    <div class="stat-label">Vittorie</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Desktop Navigation Tabs (shown on desktop only) -->
    <nav class="nav-tabs" role="navigation">
        <button class="nav-tab active" data-tab="overview" aria-selected="true">
            <span class="nav-tab-icon">üìä</span>
            <span class="nav-tab-text">Panoramica</span>
        </button>
        <button class="nav-tab" data-tab="teams" aria-selected="false">
            <span class="nav-tab-icon">üë•</span>
            <span class="nav-tab-text">Squadre</span>
        </button>
        <button class="nav-tab" data-tab="matches" aria-selected="false">
            <span class="nav-tab-icon">üèê</span>
            <span class="nav-tab-text">Partite</span>
        </button>
        <button class="nav-tab" data-tab="stats" aria-selected="false">
            <span class="nav-tab-icon">üìà</span>
            <span class="nav-tab-text">Statistiche</span>
        </button>
        <button class="nav-tab" data-tab="standings" aria-selected="false">
            <span class="nav-tab-icon">üèÜ</span>
            <span class="nav-tab-text">Classifica</span>
        </button>
        <button class="nav-tab" id="loginTabBtn" data-tab="login" aria-selected="false">
            <span class="nav-tab-icon">üîë</span>
            <span class="nav-tab-text">Login</span>
        </button>
        <button class="nav-tab" id="logoutTabBtn" data-tab="logout" aria-selected="false" style="display: none;">
            <span class="nav-tab-icon">üö™</span>
            <span class="nav-tab-text">Logout</span>
        </button>
        <button class="nav-tab" id="scoutTabBtn" data-tab="scout" aria-selected="false" style="display: none;">
            <span class="nav-tab-icon">üéØ</span>
            <span class="nav-tab-text">Scouting</span>
        </button>
        <button class="nav-tab" id="socialTabBtn" data-tab="social" aria-selected="false" style="display: none;">
            <span class="nav-tab-icon">üì±</span>
            <span class="nav-tab-text">Social Media</span>
        </button>
    </nav>

    <!-- iOS-Style Navigation Bar (mobile only) -->
    <header class="ios-navbar">
        <div class="ios-navbar-content">
            <div class="ios-large-title" id="largeTitle">Panoramica</div>
        </div>
    </header>

    <!-- Stats Header Card (mobile only - iOS grouped style) -->
    <div class="stats-header-card">
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalTeamsMobile">0</div>
                <div class="stat-label">Squadre</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalMatchesMobile">0</div>
                <div class="stat-label">Partite</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalWinsMobile">0</div>
                <div class="stat-label">Vittorie</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="winRateMobile">0%</div>
                <div class="stat-label">Win Rate</div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <main class="container">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Caricamento dati...</p>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active" style="display: none;">
            <!-- Today's Matches Section -->
            <section class="todays-matches-section" id="todaysMatchesSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìÖ</span>
                        Partite di Oggi
                    </h2>
                </div>
                <div id="todaysMatchesList" class="matches-list"></div>
            </section>

            <!-- Quick Stats -->
            <section class="quick-stats" id="quickStats" aria-label="Statistiche rapide"></section>

            <!-- Insights -->
            <section class="insights-grid" id="insightsGrid" aria-label="Insights principali"></section>

            <!-- Leaderboard -->
            <section class="leaderboard" aria-label="Classifica squadre">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üèÜ</span>
                        Classifica per Win Rate
                    </h2>
                </div>
                <div id="leaderboardList"></div>
            </section>

            <!-- Recent Matches -->
            <section aria-label="Partite recenti">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">
                            <span class="section-icon">‚ö°</span>
                            Ultime Partite
                        </h2>
                        <p class="section-subtitle">Risultati recenti</p>
                    </div>
                </div>
                <div class="matches-list" id="recentMatchesList"></div>
            </section>
        </div>

        <!-- Teams Tab -->
        <div id="teams-tab" class="tab-content">
            <div class="teams-grid" id="teamsGrid"></div>
        </div>

        <!-- Matches Tab -->
        <div id="matches-tab" class="tab-content">
            <div class="filters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label" for="filterTeam">Squadra</label>
                        <select id="filterTeam" class="filter-select">
                            <option value="">Tutte le squadre</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" for="filterStatus">Stato</label>
                        <select id="filterStatus" class="filter-select">
                            <option value="">Tutti gli stati</option>
                            <option value="gara omologata">Completate</option>
                            <option value="risultato ufficioso">Non ufficiali</option>
                            <option value="da disputare" selected>Da disputare</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" for="searchInput">Cerca</label>
                        <input type="text" id="searchInput" class="filter-input"
                            placeholder="Cerca squadra, impianto...">
                    </div>
                </div>
            </div>

            <div class="section-header">
                <div>
                    <h2 class="section-title">
                        <span class="section-icon">üìÖ</span>
                        Calendario
                    </h2>
                    <p class="section-subtitle" id="matchesSubtitle">Tutte le partite</p>
                </div>
            </div>
            <div class="matches-list" id="matchesList"></div>
        </div>

        <!-- Stats Tab (with Insights) -->
        <div id="stats-tab" class="tab-content">
            <!-- Detailed Insights Section -->
            <div id="detailedInsights"></div>

            <!-- Charts Grid -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Vittorie per Squadra</h3>
                    <div class="chart-container">
                        <canvas id="winsChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Win Rate Percentuale</h3>
                    <div class="chart-container">
                        <canvas id="winRateChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Partite per Campionato</h3>
                    <div class="chart-container">
                        <canvas id="championshipChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Set Vinti vs Persi</h3>
                    <div class="chart-container">
                        <canvas id="setsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Standings Tab -->
        <div id="standings-tab" class="tab-content">
            <div class="section-header">
                <div>
                    <h2 class="section-title">
                        <span class="section-icon">üèÜ</span>
                        Classifica
                    </h2>
                    <div class="league-selector-container">
                        <select id="leagueSelect" class="league-select">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                </div>
                <div class="last-update" id="standingsLastUpdate"></div>
            </div>
            <div class="standings-container" id="standingsContainer">
                <div class="table-responsive">
                    <table class="standings-table" id="standingsTable">
                        <thead>
                            <tr>
                                <th class="text-center">Pos</th>
                                <th>Squadra</th>
                                <th class="text-center">Pt</th>
                                <th class="text-center">G</th>
                                <th class="text-center">V</th>
                                <th class="text-center">P</th>
                                <th class="text-center mobile-hide">SF</th>
                                <th class="text-center mobile-hide">SS</th>
                            </tr>
                        </thead>
                        <tbody id="standingsBody">
                            <!-- Rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Team Detail Modal -->
    <div id="teamModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTeamName">
        <div class="modal-backdrop" onclick="closeTeamModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTeamName" class="modal-title">Team Details</h2>
                <button class="modal-close" onclick="closeTeamModal()" aria-label="Chiudi">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- iOS Bottom Tab Bar -->
    <nav class="ios-tab-bar" role="navigation">
        <button class="ios-tab active" data-tab="overview" aria-selected="true">
            <span class="ios-tab-icon">üìä</span>
            <span class="ios-tab-label">Panoramica</span>
        </button>
        <button class="ios-tab" data-tab="teams" aria-selected="false">
            <span class="ios-tab-icon">üë•</span>
            <span class="ios-tab-label">Squadre</span>
        </button>
        <button class="ios-tab" data-tab="matches" aria-selected="false">
            <span class="ios-tab-icon">üèê</span>
            <span class="ios-tab-label">Partite</span>
        </button>
        <button class="ios-tab" data-tab="stats" aria-selected="false">
            <span class="ios-tab-icon">üìà</span>
            <span class="ios-tab-label">Statistiche</span>
        </button>
        <button class="ios-tab" data-tab="standings" aria-selected="false">
            <span class="ios-tab-icon">üèÜ</span>
            <span class="ios-tab-label">Classifica</span>
        </button>
        <button class="ios-tab" id="loginTabBtnMobile" data-tab="login" aria-selected="false">
            <span class="ios-tab-icon">üîë</span>
            <span class="ios-tab-label">Login</span>
        </button>
        <button class="ios-tab" id="logoutTabBtnMobile" data-tab="logout" aria-selected="false" style="display: none;">
            <span class="ios-tab-icon">üö™</span>
            <span class="ios-tab-label">Logout</span>
        </button>
        <button class="ios-tab" id="scoutTabBtnMobile" data-tab="scout" aria-selected="false" style="display: none;">
            <span class="ios-tab-icon">üéØ</span>
            <span class="ios-tab-label">Scouting</span>
        </button>
        <button class="ios-tab" id="socialTabBtnMobile" data-tab="social" aria-selected="false" style="display: none;">
            <span class="ios-tab-icon">üì±</span>
            <span class="ios-tab-label">Social</span>
        </button>
    </nav>

    <!-- JavaScript -->
    <script src="app.js"></script>

    <!-- Scouting Link Handler -->
    <script>
        // Handle scouting tab clicks - redirect to scout page
        document.addEventListener('DOMContentLoaded', () => {
            const scoutBtns = [document.getElementById('scoutTabBtn'), document.getElementById('scoutTabBtnMobile')];
            scoutBtns.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', () => {
                        window.location.href = 'scout.html';
                    });
                }
            });

            // Handle social media tab clicks
            const socialBtns = [document.getElementById('socialTabBtn'), document.getElementById('socialTabBtnMobile')];
            socialBtns.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', () => {
                        window.location.href = 'social.html';
                    });
                }
            });
        });
    </script>

    <!-- Login/Logout handlers -->
    <script type="module">
        import { signOut } from './auth-simple.js';

        document.addEventListener('DOMContentLoaded', () => {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const loginBtnMobile = document.getElementById('loginBtnMobile');
            const logoutBtnMobile = document.getElementById('logoutBtnMobile');

            // Desktop login
            if (loginBtn) {
                loginBtn.addEventListener('click', () => {
                    window.location.href = 'login.html';
                });
            }

            // Desktop logout
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    signOut();
                    window.location.reload();
                });
            }

            // Mobile login
            if (loginBtnMobile) {
                loginBtnMobile.addEventListener('click', () => {
                    window.location.href = 'login.html';
                });
            }

            // Mobile logout
            if (logoutBtnMobile) {
                logoutBtnMobile.addEventListener('click', () => {
                    signOut();
                    window.location.reload();
                });
            }

            // Tab Login/Logout handlers
            const loginTabBtn = document.getElementById('loginTabBtn');
            const logoutTabBtn = document.getElementById('logoutTabBtn');
            const loginTabBtnMobile = document.getElementById('loginTabBtnMobile');
            const logoutTabBtnMobile = document.getElementById('logoutTabBtnMobile');

            const handleLogin = () => window.location.href = 'login.html';
            const handleLogout = () => {
                signOut();
                window.location.reload();
            };

            if (loginTabBtn) loginTabBtn.addEventListener('click', handleLogin);
            if (loginTabBtnMobile) loginTabBtnMobile.addEventListener('click', handleLogin);
            if (logoutTabBtn) logoutTabBtn.addEventListener('click', handleLogout);
            if (logoutTabBtnMobile) logoutTabBtnMobile.addEventListener('click', handleLogout);
        });
    </script>

    <!-- Tab visibility for authenticated users -->
    <script type="module" src="auth-tabs.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>